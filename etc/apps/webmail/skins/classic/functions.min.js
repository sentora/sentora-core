function rcube_init_settings_tabs(){var a,b;b=$("#tabsbar");var c=$("span:last",b),d="#settingstabpreferences",f=window.rcmail&&rcmail.env.action?rcmail.env.action:null;c&&"settingstababout"!=c.attr("id")&&(a=$("#settingstababout"))&&(b=a.clone(!0),a.remove(),c.after(b));f&&(d="#settingstab"+(0<f.indexOf("identity")?"identities":f.replace(/\./g,"")));$(d).addClass("tablink-selected");$("a",d).removeAttr("onclick").click(function(){return!1})}
function rcube_init_tabs(a,b){var c=$("#"+a),d=c.children("fieldset");if(d.length){b=b?b:0;d.each(function(a){a!=b&&$(this).hide()});var f=$("<div>").addClass("tabsbar").appendTo(c);d.each(function(c){var d,k,l=$(this),h=l.children("legend");k=$("<a>").text(h.text()).attr("href","#");d=$("<span>").attr({id:"tab"+c,"class":"tablink"}).click(function(){rcube_show_tab(a,c);return!1});h.remove();l.addClass("tabbed");c==b&&d.addClass("tablink-selected");d.append(k).appendTo(f)})}}
function rcube_show_tab(a,b){$("#"+a).children("fieldset").each(function(a){$(this)[b==a?"show":"hide"]();$("#tab"+a).toggleClass("tablink-selected",a==b)})}
function rcube_mail_ui(){this.popups={markmenu:{id:"markmessagemenu"},replyallmenu:{id:"replyallmenu"},forwardmenu:{id:"forwardmenu",editable:1},searchmenu:{id:"searchmenu",editable:1},messagemenu:{id:"messagemenu"},attachmentmenu:{id:"attachmentmenu"},listmenu:{id:"listmenu",editable:1},dragmenu:{id:"dragmenu",sticky:1},groupmenu:{id:"groupoptionsmenu",above:1},mailboxmenu:{id:"mailboxoptionsmenu",above:1},composemenu:{id:"composeoptionsmenu",editable:1,overlap:1},spellmenu:{id:"spellmenu"},responsesmenu:{id:"responsesmenu"},
uploadmenu:{id:"attachment-form",editable:1,above:1,toggle:!bw.ie&&!bw.linux},uploadform:{id:"upload-form",editable:1,toggle:!bw.ie&&!bw.linux}};var a,b;for(b in this.popups)a=$("#"+this.popups[b].id),a.length?this.popups[b].obj=a:delete this.popups[b]}
rcube_mail_ui.prototype={show_popup:function(a,b,c){var d;!this.popups[a]&&(d=$("#"+a))&&d.length&&(this.popups[a]=$.extend(c,{id:a,obj:d}));return"function"==typeof this[a]?this[a](b):this.show_popupmenu(a,b)},show_popupmenu:function(a,b){var c=this.popups[a].obj,d=this.popups[a].above,f=$(this.popups[a].link?this.popups[a].link:rcube_find_object(a+"link"));"undefined"==typeof b?b=c.is(":visible")?!1:!0:this.popups[a].toggle&&b&&this.popups[a].obj.is(":visible")&&(b=!1);if(b&&f.length){var e=f.parent(),
g=$(window),e=e.hasClass("dropbutton")?e.offset():f.offset();!d&&e.top+f.height()+c.height()>g.height()&&(d=!0);e.left+c.width()>g.width()&&(e.left=g.width()-c.width()-30);c.css({left:e.left,top:e.top+(d?-c.height():f.height())})}c[b?"show":"hide"]();bw.ie6&&this.popups[a].overlap&&($("select").css("visibility",b?"hidden":"inherit"),$("select",c).css("visibility","inherit"))},dragmenu:function(a){this.popups.dragmenu.obj[a?"show":"hide"]()},forwardmenu:function(a){$("input[name='forwardtype'][value="+
(rcmail.env.forward_attachment?1:0)+"]",this.popups.forwardmenu.obj).prop("checked",!0);this.show_popupmenu("forwardmenu",a)},uploadmenu:function(a){"object"==typeof a&&(a=!1);if(!a)try{$("#attachment-form form")[0].reset()}catch(b){}this.show_popupmenu("uploadmenu",a);!document.all&&this.popups.uploadmenu.obj.is(":visible")&&$("#attachment-form input[type=file]").click()},searchmenu:function(a){var b=this.popups.searchmenu.obj,c=rcube_find_object("searchmenulink");"undefined"==typeof a&&(a=b.is(":visible")?
!1:!0);if(a&&c){var d=$(c).offset();b.css({left:d.left,top:d.top+c.offsetHeight+2});if(rcmail.env.search_mods){var f,e,c=$('input:checkbox[name="s_mods[]"]',b),d=rcmail.env.mailbox,g=rcmail.env.search_mods;"mail"==rcmail.env.task?(g=g[d]?g[d]:g["*"],e="text"):e="*";if(g[e])c.map(function(){this.checked=!0;this.disabled=this.value!=e});else for(f in c.prop("disabled",!1).prop("checked",!1),g)$("#s_mod_"+f).prop("checked",!0)}}b[a?"show":"hide"]()},set_searchmod:function(a){var b,c;b=rcmail.env.task;
var d=rcmail.env.search_mods,f=rcmail.env.mailbox;d||(d={});"mail"==b?(d[f]||(d[f]=rcube_clone_object(d["*"])),c=d[f],b="text"):(c=d,b="*");a.checked?c[a.value]=1:delete c[a.value];a.value==b&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=a&&(this.checked=!0,a.checked?(this.disabled=!0,delete c[this.value]):(this.disabled=!1,c[this.value]=1))})},listmenu:function(a){var b=this.popups.listmenu.obj,c=rcube_find_object("listmenulink");"undefined"==typeof a&&(a=b.is(":visible")?!1:!0);if(a&&
c){var d=$(c).offset(),f=b.width();$(document).width()-d.left<f&&d.left>f&&(d.left-=f);b.css({left:d.left,top:d.top+c.offsetHeight+2});$('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0);$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order);$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order);$('input[name="view"][value="thread"]').prop("checked",rcmail.env.threading?!0:!1);$('input[name="view"][value="list"]').prop("checked",
rcmail.env.threading?!1:!0);$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=jQuery.inArray(this.value,rcmail.env.coltypes))})}b[a?"show":"hide"]();if(a){var e=0;$("#listmenu fieldset").each(function(){var a=$(this).height();a>e&&(e=a)});$("#listmenu fieldset").css("min-height",e+"px").height(e)}},open_listmenu:function(){this.listmenu()},save_listmenu:function(){this.listmenu();var a=$('input[name="sort_col"]:checked').val(),b=$('input[name="sort_ord"]:checked').val(),c=$('input[name="view"]:checked').val(),
d=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(d,a,b,"thread"==c?1:0)},spellmenu:function(a){var b,c,d=rcmail.spellcheck_lang(),f=this.popups.spellmenu.obj,e=$("ul",f);if(!e.length){e=$("<ul>");for(i in rcmail.env.spell_langs)c=$("<li>"),b=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))}),b.appendTo(c),c.appendTo(e);e.appendTo(f)}$("li",
e).each(function(){var a=$("a",this);a.data("lang")==d?a.addClass("selected"):a.hasClass("selected")&&a.removeClass("selected")});this.show_popupmenu("spellmenu",a)},show_attachmentmenu:function(a){var b=a.parentNode.id.replace(/^attach/,"");$("#attachmenuopen").unbind("click").attr("onclick","").click(function(a){return rcmail.command("open-attachment",b,this)});$("#attachmenudownload").unbind("click").attr("onclick","").click(function(){rcmail.command("download-attachment",b,this)});this.popups.attachmentmenu.link=
a;rcmail.command("menu-open",{menu:"attachmentmenu",id:b})},menu_open:function(a){a&&a.props&&"attachmentmenu"==a.props.menu?this.show_popup("attachmentmenu"):this.open_listmenu()},menu_save:function(a){this.save_listmenu()},body_mouseup:function(a){var b=a.target;ref=this;$.each(this.popups,function(c,d){!d.obj.is(":visible")||b==rcube_find_object(c+"link")||d.toggle||b==d.obj.get(0)||d.editable&&ref.target_overlaps(b,d.id)||d.sticky&&rcube_mouse_is_over(a,rcube_find_object(d.id))||$(b).is(".folder-selector-link")||
$(b).children(".folder-selector-link").length||window.setTimeout('rcmail_ui.show_popup("'+c+'",false);',50)})},target_overlaps:function(a,b){for(var c=rcube_find_object(b);a.parentNode;){if(a.parentNode==c)return!0;a=a.parentNode}return!1},body_keydown:function(a){if(27==a.keyCode)for(var b in this.popups)this.popups[b].obj.is(":visible")&&this.show_popup(b,!1)},switch_preview_pane:function(a){var b,c=$("#mailpreviewframe");a.checked?(rcmail.env.contentframe="messagecontframe",mailviewsplit.layer?
(mailviewsplit.resize(),mailviewsplit.layer.elm.style.display=""):mailviewsplit.init(),bw.opera&&$("#messagelistcontainer").css({height:""}),c.show(),(b=rcmail.message_list.get_single_selection())&&rcmail.show_message(b,!1,!0)):(c.hide(),bw.ie6||bw.ie7?(b=document.getElementById("mailcontframe"),b.style.bottom=0,b.style.height=parseInt(b.parentNode.offsetHeight)+"px"):($("#mailcontframe").css({height:"auto",bottom:0}),bw.opera&&$("#messagelistcontainer").css({height:"auto"})),mailviewsplit.layer&&
(mailviewsplit.layer.elm.style.display="none"),rcmail.env.contentframe=null,rcmail.show_contentframe(!1));rcmail.command("save-pref",{name:"preview_pane",value:a.checked?1:0})},init_compose_form:function(){var a,b,c,d=["cc","bcc","replyto","followupto"],f=document.getElementById("compose-div"),e=document.getElementById("compose-headers-div");for(a=0;a<d.length;a++)b=d[a],c=$("#_"+b),c.length&&(c.on("change",{v:b},function(a){this.value&&rcmail_ui.show_header_form(a.data.v)}),""!=c.val()&&rcmail_ui.show_header_form(b));
bw.ie&&(rcube_find_object("form").onkeydown=function(a){27==rcube_event.get_keycode(a)&&rcube_event.cancel(a)});$(window).resize(function(){rcmail_ui.resize_compose_body()});$("#compose-container").resize(function(){rcmail_ui.resize_compose_body()});f.style.top=parseInt(e.offsetHeight,10)+3+"px";$(window).resize();$("#contacts-table").css("top",$("#directorylist").height()+24+"px");$("#quicksearchbox").keydown(function(a){13==rcube_event.get_keycode(a)&&rcmail.command("search")})},resize_compose_body:function(){var a=
$("#compose-div .boxlistcontent"),b=a.width()-2,a=a.height(),c=bw.ie||bw.opera?4:0;$("#compose-body_tbl").width(b+3+"px").height("");$("#compose-body_ifr").width(b+3+"px").height(a-54+"px");$("#compose-body").width(b-c+"px").height(a+"px");$("#googie_edit_layer").height(a+"px")},resize_compose_body_ev:function(){window.setTimeout(function(){rcmail_ui.resize_compose_body()},100)},show_header_form:function(a){var b,c=document.getElementById(a+"-link");if(b=this.next_sibling(c))b.style.display="none";
else if(b=this.prev_sibling(c))b.style.display="none";c.style.display="none";if(a=document.getElementById("compose-"+a))b=document.getElementById("compose-div"),c=document.getElementById("compose-headers-div"),$(a).show(),b.style.top=parseInt(c.offsetHeight,10)+3+"px",this.resize_compose_body();return!1},hide_header_form:function(a){var b,c=document.getElementById(a+"-link"),d=c.parentNode.getElementsByTagName("a");c.style.display="";for(c=0;c<d.length;c++)if("none"!=d[c].style.display)for(var f=
c+1;f<d.length;f++)if("none"!=d[f].style.display&&(b=this.next_sibling(d[c]))){b.style.display="";break}document.getElementById("_"+a).value="";if(a=document.getElementById("compose-"+a))b=document.getElementById("compose-div"),d=document.getElementById("compose-headers-div"),a.style.display="none",b.style.top=parseInt(d.offsetHeight,10)+1+"px",this.resize_compose_body();return!1},next_sibling:function(a){for(a=a.nextSibling;a&&3==a.nodeType;)a=a.nextSibling;return a},prev_sibling:function(a){for(a=
a.previousSibling;a&&3==a.nodeType;)a=a.previousSibling;return a},enable_command:function(a){"reply-list"==a.command&&1==rcmail.env.reply_all_mode&&(a=rcmail.gettext(a.status?"replylist":"replyall"),$("a.button.replyAll").attr("title",a))}};
function rcube_layer(a,b){this.name=a;this.create=function(a){var b=a.x?a.x:0,f=a.y?a.y:0,e=a.width,g=a.height,k=a.zindex,l=a.vis;a=a.parent;var h=document.createElement("DIV");h.id=this.name;h.style.position="absolute";h.style.visibility=l?2==l?"inherit":"visible":"hidden";h.style.left=b+"px";h.style.top=f+"px";e&&(h.style.width=e.toString().match(/\%$/)?e:e+"px");g&&(h.style.height=g.toString().match(/\%$/)?g:g+"px");k&&(h.style.zIndex=k);a?a.appendChild(h):document.body.appendChild(h);this.elm=
h};null!=b?(this.create(b),this.name=this.elm.id):this.elm=document.getElementById(a);if(!this.elm)return!1;this.css=this.elm.style;this.event=this.elm;this.width=this.elm.offsetWidth;this.height=this.elm.offsetHeight;this.x=parseInt(this.elm.offsetLeft);this.y=parseInt(this.elm.offsetTop);this.visible="visible"==this.css.visibility||"show"==this.css.visibility||"inherit"==this.css.visibility?!0:!1;this.move=function(a,b){this.x=a;this.y=b;this.css.left=Math.round(this.x)+"px";this.css.top=Math.round(this.y)+
"px"};this.resize=function(a,b){this.css.width=a+"px";this.css.height=b+"px";this.width=a;this.height=b};this.show=function(a){1==a?(this.css.visibility="visible",this.visible=!0):2==a?(this.css.visibility="inherit",this.visible=!0):(this.css.visibility="hidden",this.visible=!1)};this.write=function(a){this.elm.innerHTML=a}}
function rcmail_scroller(a,b,c){var d=this;this.list=$(a);this.top=$(b);this.bottom=$(c);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){d.ts=window.setTimeout(function(){d.scroll("down")},d.delay)}).mouseout(function(){d.ts&&window.clearTimeout(d.ts)});this.bottom.mouseenter(function(){d.ts=window.setTimeout(function(){d.scroll("up")},d.delay)}).mouseout(function(){d.ts&&window.clearTimeout(d.ts)});this.scroll=function(a){var b=this,c=this.step_size;rcmail.drag_active&&
("down"==a&&(c*=-1),this.list.get(0).scrollTop+=c,this.ts=window.setTimeout(function(){b.scroll(a)},this.step_time))}}function iframe_events(){try{$(this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null).mouseup(function(a){rcmail_ui.body_mouseup(a)})}catch(a){}}
function rcube_render_mailboxlist(){var a=$("#mailboxlist > li > a, #mailboxlist ul:visible > li > a");a.length>(bw.ie&&9>bw.vendver?40:100)||a.each(function(){var a=$(this),c=a.data("text");c||(c=a.text().replace(/\s+\([0-9]+\)$/,""),a.data("text",c));if(!(6>c.length)){var d=fit_string_to_size(c,a,a.width()-a.children("span.unreadcount").width()-16);d!=c&&a.attr("title",c);a.contents().filter(function(){return 3==this.nodeType}).get(0).data=d}})}
function fit_string_to_size(a,b,c){var d,f,e=a;rcmail.env.tmp_span?b=rcmail.env.tmp_span:(b=$("<b>").css({visibility:"hidden",padding:"0px","font-family":b.css("font-family"),"font-size":b.css("font-size")}).appendTo($("body",document)).get(0),rcmail.env.tmp_span=b);f=$(b);f.text(e);d=b.offsetWidth;if(d>c){c=Math.max(1,Math.floor((d-c)/d*a.length/2));for(var g=d=e=Math.floor(a.length/2);;){d=e-c;g=e+c;f.text(a.substring(0,d)+"..."+a.substring(g));if(3>d||b.offsetWidth)break;c++}e=a.substring(0,d)+
"..."+a.substring(g)}return e}function update_quota(a){percent_indicator(rcmail.gui_objects.quotadisplay,a)}
function percent_indicator(a,b){if(!b||!a)return!1;var c=b.width?b.width:rcmail.env.indicator_width?rcmail.env.indicator_width:100,d=b.height?b.height:rcmail.env.indicator_height?rcmail.env.indicator_height:14,f=b.percent?Math.abs(parseInt(b.percent)):0,e=parseInt(f/100*c),g=$(a).position();g.top=Math.max(0,g.top);g.left=Math.max(0,g.left);rcmail.env.indicator_width=c;rcmail.env.indicator_height=d;e>c&&(e=c,f=100);b.title&&(b.title=rcmail.get_label("quota")+": "+b.title);var k=$("<div>");k.css({position:"absolute",
top:g.top,left:g.left,width:c+"px",height:d+"px",zIndex:100,lineHeight:d+"px"}).attr("title",b.title).addClass("quota_text").html(f+"%");var l=$("<div>");l.css({position:"absolute",top:g.top+1,left:g.left+1,width:e+"px",height:d+"px",zIndex:99});e=$("<div>");e.css({position:"absolute",top:g.top+1,left:g.left+1,width:c+"px",height:d+"px",zIndex:98}).addClass("quota_bg");80<=f?(k.addClass(" quota_text_high"),l.addClass("quota_high")):55<=f?(k.addClass(" quota_text_mid"),l.addClass("quota_mid")):(k.addClass(" quota_text_low"),
l.addClass("quota_low"));$(a).html("").append(l).append(e).append(k);$("#quotaimg").attr("title",b.title)}var rcmail_editor_settings={skin:"default",skin_variant:""},rcmail_ui;
function rcube_init_mail_ui(){rcmail_ui=new rcube_mail_ui;$(document.body).mouseup(function(a){rcmail_ui.body_mouseup(a)}).mousedown(function(a){rcmail_ui.body_keydown(a)});rcmail.addEventListener("init",function(){rcmail.env.quota_content&&update_quota(rcmail.env.quota_content);rcmail.addEventListener("setquota",update_quota);$("iframe").load(iframe_events).contents().mouseup(function(a){rcmail_ui.body_mouseup(a)});"mail"==rcmail.env.task?(rcmail.addEventListener("enable-command","enable_command",
rcmail_ui),rcmail.addEventListener("menu-open","menu_open",rcmail_ui),rcmail.addEventListener("menu-save","menu_save",rcmail_ui),rcmail.addEventListener("aftersend-attachment","uploadmenu",rcmail_ui),rcmail.addEventListener("aftertoggle-editor","resize_compose_body_ev",rcmail_ui),rcmail.gui_object("dragmenu","dragmenu"),rcmail.gui_objects.mailboxlist&&(rcmail.treelist.addEventListener("expand",rcube_render_mailboxlist),rcmail.addEventListener("responseaftermark",rcube_render_mailboxlist),rcmail.addEventListener("responseaftergetunread",
rcube_render_mailboxlist),rcmail.addEventListener("responseaftercheck-recent",rcube_render_mailboxlist),rcmail.addEventListener("responseafterrefresh",rcube_render_mailboxlist),rcmail.addEventListener("afterimport-messages",function(){rcmail_ui.show_popup("uploadform",!1)})),"compose"==rcmail.env.action?rcmail_ui.init_compose_form():"show"!=rcmail.env.action&&"preview"!=rcmail.env.action||$('#attachment-list > li[id^="attach"]').each(function(){$(this).append($('<a class="drop"></a>').click(function(){rcmail_ui.show_attachmentmenu(this)}))})):
"addressbook"==rcmail.env.task?(rcmail.addEventListener("afterupload-photo",function(){rcmail_ui.show_popup("uploadform",!1)}),rcmail.gui_object("dragmenu","dragmenu")):"settings"==rcmail.env.task&&rcmail.gui_objects.subscriptionlist&&new rcmail_scroller("#folderlist-content","#folderlist-title","#folderlist-footer")})};
